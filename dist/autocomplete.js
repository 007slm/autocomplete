define("arale/autocomplete/1.2.1/autocomplete",["$","arale/overlay/1.1.0/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.2/iframe-shim","arale/widget/1.1.0/widget","arale/base/1.1.0/base","arale/class/1.1.0/class","arale/events/1.1.0/events","arale/templatable/0.9.0/templatable","gallery/handlebars/1.0.2/handlebars","./data-source","./filter","./autocomplete.handlebars"],function(e,t,i){function a(e){return"[object String]"===Object.prototype.toString.call(e)}function s(e,t){if(!e)return t;if(n.isFunction(e))return e.call(this,t);if(a(e)){for(var i=e.split("."),s=t;i.length;){var r=i.shift();if(!s[r])break;s=s[r]}return s}return t}function r(e,t){var i=this.highlightIndex,a=0,s=t||this.matchKey||"",r="";if(n.isArray(i)){for(var l=0,h=i.length;h>l;l++){var o,c,d=i[l];if(n.isArray(d)?(o=d[0],c=d[1]-d[0]):(o=d,c=1),o>a&&(r+=s.substring(a,o)),s.length>o&&(r+='<span class="'+e+'-item-hl">'+s.substr(o,c)+"</span>"),a=o+c,a>=s.length)break}return s.length>a&&(r+=s.substring(a,s.length)),new u.SafeString(r)}return s}var n=e("$"),l=e("arale/overlay/1.1.0/overlay"),h=e("arale/templatable/0.9.0/templatable"),u=e("gallery/handlebars/1.0.2/handlebars"),o=e("./data-source"),c=e("./filter"),d=e("./autocomplete.handlebars"),f={UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,ESC:27,BACKSPACE:8},g=l.extend({Implements:h,attrs:{trigger:{value:null,getter:function(e){return n(e)}},classPrefix:"ui-autocomplete",align:{baseXY:[0,"100%"]},template:d,submitOnEnter:!0,dataSource:[],locator:"data",filter:void 0,inputFilter:function(e){return e},disabled:!1,selectFirst:!1,delay:100,selectedIndex:void 0,inputValue:null,data:null},events:{"mousedown [data-role=item]":function(e){var t=this.items.index(e.currentTarget);this.set("selectedIndex",t),this.selectItem(),this._firstMousedown=!0},mousedown:function(){this._secondMousedown=!0},"mouseenter [data-role=item]":function(e){var t=this.get("classPrefix")+"-item-hover";this.currentItem&&this.currentItem.removeClass(t),n(e.currentTarget).addClass(t)},"mouseleave [data-role=item]":function(e){var t=this.get("classPrefix")+"-item-hover";n(e.currentTarget).removeClass(t)}},templateHelpers:{highlightItem:r},parseElement:function(){this.set("model",{classPrefix:this.get("classPrefix"),items:[]}),g.superclass.parseElement.call(this)},setup:function(){var e=this.get("trigger"),t=this;g.superclass.setup.call(this),this.dataSource=new o({source:this.get("dataSource")}).on("data",this._filterData,this),this._initFilter(),this._blurHide([e]),this._tweakAlignDefaultValue(),e.attr("autocomplete","off"),this.delegateEvents(e,"blur.autocomplete",n.proxy(this._blurEvent,this)),this.delegateEvents(e,"keydown.autocomplete",n.proxy(this._keydownEvent,this)),this.delegateEvents(e,"keyup.autocomplete",function(){clearTimeout(t._timeout),t._timeout=setTimeout(function(){t._timeout=null,t._keyupEvent.call(t)},t.get("delay"))})},destroy:function(){this._clear(),this.element.remove(),g.superclass.destroy.call(this)},hide:function(){this._timeout&&clearTimeout(this._timeout),this.dataSource.abort(),g.superclass.hide.call(this)},selectItem:function(){this.hide();var e=this.currentItem,t=this.get("selectedIndex"),i=this.get("data")[t];if(e){var a=e.attr("data-value");this.get("trigger").val(a),this.set("inputValue",a),this.trigger("itemSelect",i),this._clear()}},setInputValue:function(e){if(this.get("inputValue")!==e){this._start=!0,this.set("inputValue",e);var t=this.get("trigger");t.val()!==e&&t.val(e)}},_onRenderInputValue:function(e){if(this._start&&e){var t=this.queryValue;this.queryValue=this.get("inputFilter").call(this,e),this.queryValue&&this.queryValue!==t&&(this.dataSource.abort(),this.dataSource.getData(this.queryValue))}else this.queryValue="";""!==e&&this.queryValue||(this.set("data",[]),this.hide()),delete this._start},_filterData:function(e){var t=this.get("filter"),i=this.get("locator");e=s(i,e),e=t.func.call(this,e,this.queryValue,t.options),this.set("data",e)},_onRenderData:function(e){this._clear(),this.set("model",{items:e}),this.renderPartial("[data-role=items]"),this.items=this.$("[data-role=items]").children(),this.currentItem=null,this.get("selectFirst")&&this.set("selectedIndex",0),n.trim(this.$("[data-role=items]").text())?this.show():this.hide()},_onRenderSelectedIndex:function(e){if(-1!==e){var t=this.get("classPrefix")+"-item-hover";this.currentItem&&this.currentItem.removeClass(t),this.currentItem=this.items.eq(e).addClass(t),this.trigger("indexChange",e,this.lastIndex),this.lastIndex=e}},_initFilter:function(){var e=this.get("filter");e=void 0===e?"url"===this.dataSource.get("type")?null:{name:"startsWith",func:c.startsWith,options:{key:"value"}}:n.isPlainObject(e)?c[e.name]?{name:e.name,func:c[e.name],options:e.options}:null:n.isFunction(e)?{func:e}:c[e]?{name:e,func:c[e]}:null,e||(e={name:"default",func:c["default"]}),this.set("filter",e)},_blurEvent:function(){n.browser.msie||(this._secondMousedown?this._firstMousedown&&(this.get("trigger").focus(),this.hide()):this.hide(),delete this._firstMousedown,delete this._secondMousedown)},_keyupEvent:function(){if(!this.get("disabled")&&this._keyupStart){delete this._keyupStart;var e=this.get("trigger").val();this.setInputValue(e)}},_keydownEvent:function(e){if(!this.get("disabled"))switch(delete this._keyupStart,e.which){case f.ESC:this.hide();break;case f.UP:this._keyUp(e);break;case f.DOWN:this._keyDown(e);break;case f.LEFT:case f.RIGHT:break;case f.ENTER:this._keyEnter(e);break;default:this._keyupStart=!0}},_keyUp:function(e){if(e.preventDefault(),this.get("data").length){if(!this.get("visible"))return this.show(),void 0;this._step(-1)}},_keyDown:function(e){if(e.preventDefault(),this.get("data").length){if(!this.get("visible"))return this.show(),void 0;this._step(1)}},_keyEnter:function(e){this.get("visible")&&(this.selectItem(),this.get("submitOnEnter")||e.preventDefault())},_step:function(e){var t=this.get("selectedIndex");-1===e?t>0?this.set("selectedIndex",t-1):this.set("selectedIndex",this.items.length-1):1===e&&(this.items.length-1>t?this.set("selectedIndex",t+1):this.set("selectedIndex",0))},_clear:function(){this.$("[data-role=items]").empty(),this.set("selectedIndex",-1),delete this.items,delete this.lastIndex,delete this.currentItem},_tweakAlignDefaultValue:function(){var e=this.get("align");e.baseElement=this.get("trigger"),this.set("align",e)}});i.exports=g}),define("arale/autocomplete/1.2.1/data-source",["arale/base/1.1.0/base","arale/class/1.1.0/class","arale/events/1.1.0/events","$"],function(e,t,i){function a(e){return"[object String]"===Object.prototype.toString.call(e)}function s(e){return e.replace(/^([a-z])/,function(e,t){return t.toUpperCase()})}var r=e("arale/base/1.1.0/base"),n=e("$"),l=r.extend({attrs:{source:null,type:"array"},initialize:function(e){l.superclass.initialize.call(this,e),this.id=0,this.callbacks=[];var t=this.get("source");if(a(t))this.set("type","url");else if(n.isArray(t))this.set("type","array");else if(n.isPlainObject(t))this.set("type","object");else{if(!n.isFunction(t))throw Error("Source Type Error");this.set("type","function")}},getData:function(e){return this["_get"+s(this.get("type")||"")+"Data"](e)},abort:function(){this.callbacks=[]},_done:function(e){this.trigger("data",e)},_getUrlData:function(e){var t,i=this,a={query:e?encodeURIComponent(e):"",timestamp:(new Date).getTime()},s=this.get("source").replace(/{{(.*?)}}/g,function(e,t){return a[t]}),r="callback_"+this.id++;this.callbacks.push(r),t=/^(https?:\/\/)/.test(s)?{dataType:"jsonp"}:{dataType:"json"},n.ajax(s,t).success(function(e){n.inArray(r,i.callbacks)>-1&&(delete i.callbacks[r],i._done(e))}).error(function(){n.inArray(r,i.callbacks)>-1&&(delete i.callbacks[r],i._done({}))})},_getArrayData:function(){var e=this.get("source");return this._done(e),e},_getObjectData:function(){var e=this.get("source");return this._done(e),e},_getFunctionData:function(e){function t(e){i._done(e)}var i=this,a=this.get("source"),s=a.call(this,e,t);s&&this._done(s)}});i.exports=l}),define("arale/autocomplete/1.2.1/filter",["$"],function(e,t,i){function a(e,t){if(n.isPlainObject(e)){var i=t&&t.key||"value";return e[i]||""}return e}function s(e,t){for(var i=[],a=e.split(""),s=0,r=t.split(""),n=0,l=a.length;l>n;n++){var h=a[n];if(h==r[s]){if(s===r.length-1){i.push([n-r.length+1,n+1]),s=0;continue}s++}else s=0}return i}function r(e){return(e||"").replace(h,"\\$1")}var n=e("$"),l={"default":function(e,t,i){var s=[];return n.each(e,function(e,t){var r={},l=a(t,i);n.isPlainObject(t)&&(r=n.extend({},t)),r.matchKey=l,s.push(r)}),s},startsWith:function(e,t,i){var s=[],l=t.length,h=RegExp("^"+r(t));return l?(n.each(e,function(e,t){var r={},u=a(t,i);n.isPlainObject(t)&&(r=n.extend({},t)),h.test(u)&&(r.matchKey=u,l>0&&(r.highlightIndex=[[0,l]]),s.push(r))}),s):[]},stringMatch:function(e,t,i){t=t||"";var r=[],l=t.length;return l?(n.each(e,function(e,l){var h={},u=a(l,i);n.isPlainObject(l)&&(h=n.extend({},l)),u.indexOf(t)>-1&&(h.matchKey=u,h.highlightIndex=s(u,t),r.push(h))}),r):[]}};i.exports=l;var h=/(\[|\[|\]|\^|\$|\||\(|\)|\{|\}|\+|\*|\?)/g}),define("arale/autocomplete/1.2.1/autocomplete.handlebars",["gallery/handlebars/1.0.2/handlebars"],function(e,t,i){var a=e("gallery/handlebars/1.0.2/handlebars"),s=a.template;i.exports=s(function(e,t,i,a,s){function r(e,t,a){var s,r,n,l="";return l+='\n            <li data-role="item" class="'+o((s=a.classPrefix,typeof s===u?s.apply(e):s))+'-item" data-value="',(r=i.matchKey)?r=r.call(e,{hash:{},data:t}):(r=e.matchKey,r=typeof r===u?r.apply(e):r),l+=o(r)+'">',n={hash:{},data:t},l+=o((s=i.highlightItem,s?s.call(e,a.classPrefix,e.matchKey,n):c.call(e,"highlightItem",a.classPrefix,e.matchKey,n)))+"</li>\n        "}this.compilerInfo=[3,">= 1.0.0-rc.4"],i=i||{};for(var n in e.helpers)i[n]=i[n]||e.helpers[n];s=s||{};var l,h="",u="function",o=this.escapeExpression,c=i.helperMissing,d=this;return h+='<div class="',(l=i.classPrefix)?l=l.call(t,{hash:{},data:s}):(l=t.classPrefix,l=typeof l===u?l.apply(t):l),h+=o(l)+'">\n    <ul class="',(l=i.classPrefix)?l=l.call(t,{hash:{},data:s}):(l=t.classPrefix,l=typeof l===u?l.apply(t):l),h+=o(l)+'-ctn" data-role="items">\n        ',l=i.each.call(t,t.items,{hash:{},inverse:d.noop,fn:d.programWithDepth(1,r,s,t),data:s}),(l||0===l)&&(h+=l),h+="\n    </ul>\n</div>\n"})});
